<div id="glowscript" class="glowscript">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="text/css" href="https://www.glowscript.org/css/redmond/2.1/jquery-ui.custom.css" rel="stylesheet" />
<link type="text/css" href="https://www.glowscript.org/css/ide.css" rel="stylesheet" />
<script type="text/javascript" src="https://www.glowscript.org/lib/jquery/2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.glowscript.org/lib/jquery/2.1/jquery-ui.custom.min.js"></script>
<script type="text/javascript" src="https://www.glowscript.org/package/glow.3.2.min.js"></script>
<script type="text/javascript" src="https://www.glowscript.org/package/RSrun.3.2.min.js"></script>
<script type="text/javascript"><!--//--><![CDATA[//><!--

// START JAVASCRIPT
;(function() {;
var ρσ_modules = {};
var fire_power, target_num_particles, simulation_speed, show_bins;
ρσ_modules.pythonize = {};

(function(){
    function strings() {
        var string_funcs, exclude, name;
        string_funcs = set("capitalize strip lstrip rstrip islower isupper isspace lower upper swapcase center count endswith startswith find rfind index rindex format join ljust rjust partition rpartition replace split rsplit splitlines zfill".split(" "));
        if (!arguments.length) {
            exclude = (function(){
                var s = ρσ_set();
                s.jsset.add("split");
                s.jsset.add("replace");
                return s;
            })();
        } else if (arguments[0]) {
            exclude = Array.prototype.slice.call(arguments);
        } else {
            exclude = null;
        }
        if (exclude) {
            string_funcs = string_funcs.difference(set(exclude));
        }
        var ρσ_Iter0 = string_funcs;
        ρσ_Iter0 = ((typeof ρσ_Iter0[Symbol.iterator] === "function") ? (ρσ_Iter0 instanceof Map ? ρσ_Iter0.keys() : ρσ_Iter0) : Object.keys(ρσ_Iter0));
        for (var ρσ_Index0 of ρσ_Iter0) {
            name = ρσ_Index0;
            (ρσ_expr_temp = String.prototype)[(typeof name === "number" && name < 0) ? ρσ_expr_temp.length + name : name] = (ρσ_expr_temp = ρσ_str.prototype)[(typeof name === "number" && name < 0) ? ρσ_expr_temp.length + name : name];
        }
    };
    if (!strings.__module__) Object.defineProperties(strings, {
        __module__ : {value: "pythonize"}
    });

    ρσ_modules.pythonize.strings = strings;
})();
async function __main__() {
"use strict";
    var display = canvas;
    var scene = canvas();

    function round(num, n=0) {return Number(num.toFixed(n))}

    var version, print, arange, __name__, type, ρσ_ls, GAUSS_STD_DEV, dt, gravity, particles, hearth_radius, hearth_height, hearth, num_stones, angle, stone_rad, stone_dist, stone_x, stone_z, stone_y, i, fire_power, target_num_particles, simulation_speed, show_bins, power_slider, power_label, particle_slider, particle_label, speed_slider, speed_label, spread_label, entropy_label, p, bin_visuals, effective_dt, sum_y, sum_y_sq, bins, p_to_remove, turbulence, buoyancy, net_force, acceleration, bin_key, life_fraction, height_color_mix, power_min, power_mid, power_max, start_low, end_low, start_mid, end_mid, start_high, end_high, frac, start_color, end_color, n, mean_y, variance_y, std_dev_y, sum_ni_ln_ni, max_ni, ni, entropy, bin_index, color_low, color_mid, color_high, new_bin_box, b, coords, x, y, z, fraction, ρσ_unpack, key;
    version = ρσ_list_decorate([ "3.2", "glowscript" ]);
    Array.prototype['+'] = function(r) {return this.concat(r)}
    Array.prototype['*'] = function(r) {return __array_times_number(this, r)}
    window.__GSlang = "vpython";
    print = GSprint;
    arange = range;
    __name__ = "__main__";
    type = pytype;
    var strings = ρσ_modules.pythonize.strings;

    strings();
    "10";
    scene.caption = "To rotate the camera, drag with the right mouse button.\nTo zoom, use the mouse wheel.";
    "11";
    scene.background = color.black;
    "12";
    scene.width = 800;
    "13";
    scene.height = 600;
    "14";
    scene.center = vector(0, 2, 0);
    "15";
    scene.camera.pos = vector(0, 6, 25);
    "16";
    scene.camera.clip = false;
    "19";
    GAUSS_STD_DEV = 1.2;
    "20";
    dt = .02;
    "21";
    gravity = vector(0, 1["-u"]()["*"](9.8), 0);
    "22";
    particles = ρσ_list_decorate([]);
    "24";
    hearth_radius = 3;
    "25";
    hearth_height = .2;
    "27";
    hearth = ρσ_interpolate_kwargs.call(this, cylinder, [ρσ_desugar_kwargs({pos: vector(0, 1["-u"]()["*"](hearth_height)["/"](2), 0), radius: hearth_radius, axis: vector(0, hearth_height, 0), color: vector(.4, .25, .1)})]);
    "34";
    num_stones = 30;
    "35";
    for (var ρσ_Index1 = 0; ρσ_Index1["<"](num_stones); ρσ_Index1++) {
        i = ρσ_Index1;
        "36";
        angle = 2["*"](pi)["*"](i)["/"](num_stones);
        "37";
        stone_rad = (await uniform(.4, .7));
        "38";
        stone_dist = (await uniform(hearth_radius["-"](1["*"](stone_rad)["*"](.6)), hearth_radius["-"](1["*"](stone_rad)["*"](.3))));
        "39";
        stone_x = stone_dist["*"](cos(angle));
        "40";
        stone_z = stone_dist["*"](sin(angle));
        "41";
        stone_y = 1["-u"]()["*"](stone_rad)["*"](.3);
        "42";
        ρσ_interpolate_kwargs.call(this, sphere, [ρσ_desugar_kwargs({pos: vector(stone_x, stone_y, stone_z), radius: stone_rad, color: color.gray((await uniform(.3, .6)))})]);
    }
    "48";
    async function mix_colors(color1, color2, fraction) {
        "50";
        fraction = max(0, min(1, fraction));
        "51";
        return color1["*"](1["-"](1["*"](fraction)))["+"](color2["*"](fraction));
    };
    if (!mix_colors.__argnames__) Object.defineProperties(mix_colors, {
        __argnames__ : {value: ["color1", "color2", "fraction"]},
        __module__ : {value: null}
    });

    "53";
    async function uniform(a, b) {
        "55";
        return a["+"](b["-"](1["*"](a))["*"](random()));
    };
    if (!uniform.__argnames__) Object.defineProperties(uniform, {
        __argnames__ : {value: ["a", "b"]},
        __module__ : {value: null}
    });

    "58";
    fire_power = 1;
    "59";
    target_num_particles = 1e3;
    "60";
    simulation_speed = 1;
    "61";
    show_bins = false;
    "63";
    async function set_power(s) {
        "64";
        "65";
        fire_power = s.value;
        "66";
        power_label.text = "Fire Power: "["+"](ρσ_str.format("{:.2f}", fire_power))["+"]("");
    };
    if (!set_power.__argnames__) Object.defineProperties(set_power, {
        __argnames__ : {value: ["s"]},
        __module__ : {value: null}
    });

    "68";
    async function set_particle_count(s) {
        "69";
        "70";
        target_num_particles = int(s.value);
        "71";
        particle_label.text = "Particle Count: "["+"](ρσ_str.format("{}", target_num_particles))["+"]("");
    };
    if (!set_particle_count.__argnames__) Object.defineProperties(set_particle_count, {
        __argnames__ : {value: ["s"]},
        __module__ : {value: null}
    });

    "73";
    async function set_speed(s) {
        "74";
        "75";
        simulation_speed = s.value;
        "76";
        speed_label.text = "Simulation Speed: "["+"](ρσ_str.format("{:.2f}", simulation_speed))["+"]("x");
    };
    if (!set_speed.__argnames__) Object.defineProperties(set_speed, {
        __argnames__ : {value: ["s"]},
        __module__ : {value: null}
    });

    "78";
    async function toggle_bins(c) {
        "79";
        "80";
        show_bins = c.checked;
    };
    if (!toggle_bins.__argnames__) Object.defineProperties(toggle_bins, {
        __argnames__ : {value: ["c"]},
        __module__ : {value: null}
    });

    "82";
    power_slider = ρσ_interpolate_kwargs.call(this, slider, [ρσ_desugar_kwargs({min: .5, max: 5, value: 1, length: 220, bind: set_power, right: 15})]);
    "83";
    power_label = ρσ_interpolate_kwargs.call(this, wtext, [ρσ_desugar_kwargs({text: "Fire Power: "["+"](ρσ_str.format("{:.2f}", fire_power))["+"]("")})]);
    "84";
    scene.append_to_caption("\n");
    "86";
    particle_slider = ρσ_interpolate_kwargs.call(this, slider, [ρσ_desugar_kwargs({min: 100, max: 2e3, value: 1e3, step: 50, length: 220, bind: set_particle_count, right: 15})]);
    "87";
    particle_label = ρσ_interpolate_kwargs.call(this, wtext, [ρσ_desugar_kwargs({text: "Particle Count: "["+"](ρσ_str.format("{}", target_num_particles))["+"]("")})]);
    "88";
    scene.append_to_caption("\n");
    "90";
    speed_slider = ρσ_interpolate_kwargs.call(this, slider, [ρσ_desugar_kwargs({min: .1, max: 2, value: 1, step: .1, length: 220, bind: set_speed, right: 15})]);
    "91";
    speed_label = ρσ_interpolate_kwargs.call(this, wtext, [ρσ_desugar_kwargs({text: "Simulation Speed: "["+"](ρσ_str.format("{:.2f}", simulation_speed))["+"]("x")})]);
    "92";
    scene.append_to_caption("\n");
    "94";
    spread_label = ρσ_interpolate_kwargs.call(this, wtext, [ρσ_desugar_kwargs({text: "Spread (Std Dev Y): 0.00"})]);
    "95";
    scene.append_to_caption("\n");
    "97";
    entropy_label = ρσ_interpolate_kwargs.call(this, wtext, [ρσ_desugar_kwargs({text: "Boltzmann Entropy (S): 0.00"})]);
    "98";
    scene.append_to_caption("\n");
    "100";
    ρσ_interpolate_kwargs.call(this, checkbox, [ρσ_desugar_kwargs({bind: toggle_bins, text: "Show Entropy Bins"})]);
    "101";
    scene.append_to_caption("\n\n");
    "105";
    async function reset_particle(p) {
        var ρσ_ls, r1, r2, px, pz, distance_from_center, normalized_distance, shape_focus, base_y_velocity;
        "110";
        while (true) {
            "111";
            r1 = random()["+"](1e-10);
            "112";
            r2 = random();
            "114";
            px = GAUSS_STD_DEV["*"](sqrt(1["-u"]()["*"](2)["*"](log(r1))))["*"](cos(2["*"](pi)["*"](r2)));
            "115";
            pz = GAUSS_STD_DEV["*"](sqrt(1["-u"]()["*"](2)["*"](log(r1))))["*"](sin(2["*"](pi)["*"](r2)));
            "117";
            p.pos = vector(px, 0, pz);
            "119";
            if (mag(p.pos)["<="](hearth_radius)) {
                "120";
                break;
            }
        }
        "123";
        distance_from_center = mag(p.pos);
        "124";
        normalized_distance = min(1, distance_from_center["/"](hearth_radius));
        "125";
        shape_focus = 1.5["/"](fire_power["+"](.5));
        "126";
        p.local_power = Math.pow((1["-"](1["*"](normalized_distance))), (2["*"](shape_focus)));
        "129";
        base_y_velocity = .5["+"](2.5["*"](p.local_power));
        "130";
        p.velocity = vector((await uniform(1["-u"]()["*"](.2), .2)), base_y_velocity, (await uniform(1["-u"]()["*"](.2), .2)));
        "133";
        p.age = 0;
        "134";
        p.lifetime = (await uniform(.4, .8))["*"](1["+"](fire_power["*"](.15)))["*"](.4["+"](.6["*"](p.local_power)));
        "137";
        p.visible = true;
        "138";
        p.radius = .1;
        "139";
        p.opacity = 1;
    };
    if (!reset_particle.__argnames__) Object.defineProperties(reset_particle, {
        __argnames__ : {value: ["p"]},
        __module__ : {value: null}
    });

    "143";
    for (var ρσ_Index2 = 0; ρσ_Index2["<"](target_num_particles); ρσ_Index2++) {
        i = ρσ_Index2;
        "144";
        p = ρσ_interpolate_kwargs.call(this, sphere, [ρσ_desugar_kwargs({pos: vector(0, 0, 0), radius: .1, visible: false, emissive: true})]);
        "150";
        p.velocity = vector(0, 0, 0);
        "151";
        p.age = 0;
        "152";
        p.lifetime = 0;
        "153";
        p.local_power = 0;
        "154";
        particles.append(p);
        "155";
        (await reset_particle(p));
    }
    "157";
    bin_visuals = ρσ_list_decorate([]);
    "160";
    while (true) {
        "161";
        (await rate(60));
        "163";
        effective_dt = dt["*"](simulation_speed);
        "165";
        sum_y = 0;
        "166";
        sum_y_sq = 0;
        "167";
        bins = ρσ_dict();
        "170";
        while (len(particles)["<"](target_num_particles)) {
            "171";
            p = ρσ_interpolate_kwargs.call(this, sphere, [ρσ_desugar_kwargs({pos: vector(0, 0, 0), radius: .1, visible: false, emissive: true})]);
            "172";
            p.velocity = vector(0, 0, 0);
            "173";
            p.age = 0;
            "174";
            p.lifetime = 0;
            "175";
            p.local_power = 0;
            "176";
            particles.append(p);
            "177";
            (await reset_particle(p));
        }
        "179";
        while (len(particles)[">"](target_num_particles)) {
            "180";
            p_to_remove = particles.pypop();
            "181";
            p_to_remove.visible = false;
            "182";
            p_to_remove = undefined;
        }
        "185";
        var ρσ_Iter3 = particles;
        ρσ_Iter3 = ((typeof ρσ_Iter3[Symbol.iterator] === "function") ? (ρσ_Iter3 instanceof Map ? ρσ_Iter3.keys() : ρσ_Iter3) : Object.keys(ρσ_Iter3));
        for (var ρσ_Index3 of ρσ_Iter3) {
            p = ρσ_Index3;
            "187";
            turbulence = vector((await uniform(1["-u"]()["*"](8), 8)), (await uniform(1["-u"]()["*"](2), 5)), (await uniform(1["-u"]()["*"](8), 8)));
            "188";
            buoyancy = 1["-u"]()["*"](gravity)["*"](2.5);
            "189";
            net_force = buoyancy["+"](gravity)["+"](turbulence);
            "191";
            acceleration = net_force["/"](1);
            "193";
            p.velocity=p.velocity["+"](acceleration["*"](effective_dt));
            "194";
            p.pos=p.pos["+"](p.velocity["*"](effective_dt));
            "197";
            p.age=p.age["+"](effective_dt);
            "200";
            sum_y=sum_y["+"](p.pos.y);
            "201";
            sum_y_sq=sum_y_sq["+"](Math.pow(p.pos.y, 2));
            "203";
            bin_key = ""["+"](ρσ_str.format("{}", floor(p.pos.x)))["+"](",")["+"](ρσ_str.format("{}", floor(p.pos.y)))["+"](",")["+"](ρσ_str.format("{}", floor(p.pos.z)))["+"]("");
            "204";
            ρσ_setitem(bins, bin_key, bins.get(bin_key, 0)["+"](1));
            "207";
            life_fraction = p.age["/"](p.lifetime);
            "208";
            height_color_mix = min(1, p.pos.y["/"](3["+"](fire_power["*"](1.2))));
            "211";
            power_min = .5;
            "212";
            power_mid = 2.65;
            "213";
            power_max = 5;
            "214";
            start_low = color.orange;
            "215";
            end_low = color.red;
            "216";
            start_mid = color.yellow;
            "217";
            end_mid = color.orange;
            "218";
            start_high = color.white;
            "219";
            end_high = vector(.2, .5, 1);
            "221";
            if (fire_power["<="](power_mid)) {
                "222";
                frac = fire_power["-"](1["*"](power_min))["/"](power_mid["-"](1["*"](power_min)));
                "223";
                start_color = (await mix_colors(start_low, start_mid, frac));
                "224";
                end_color = (await mix_colors(end_low, end_mid, frac));
                "225";
            } else {
                "226";
                frac = fire_power["-"](1["*"](power_mid))["/"](power_max["-"](1["*"](power_mid)));
                "227";
                start_color = (await mix_colors(start_mid, start_high, frac));
                "228";
                end_color = (await mix_colors(end_mid, end_high, frac));
            }
            "230";
            p.color = (await mix_colors(start_color, end_color, height_color_mix));
            "231";
            p.radius = .1["*"](1["-"](1["*"](life_fraction)));
            "232";
            p.opacity = 1["-"](1["*"](life_fraction));
            "235";
            if (p.age[">="](p.lifetime)) {
                "236";
                p.visible = false;
                "237";
                (await reset_particle(p));
            }
        }
        "240";
        n = len(particles);
        "241";
        if (n[">"](0)) {
            "243";
            mean_y = sum_y["/"](n);
            "244";
            variance_y = max(0, sum_y_sq["/"](n)["-"](1["*"](Math.pow(mean_y, 2))));
            "245";
            std_dev_y = sqrt(variance_y);
            "246";
            spread_label.text = "Spread (Std Dev Y): "["+"](ρσ_str.format("{:.2f}", std_dev_y))["+"]("");
            "Here's a quick explenation detailing how it works:\n            We divide the 3D space into a grid of 1x1x1 bins (small cubes basically)\n            We count how many particles are in each bin (call it Ni)\n            We use Stirling's approximation of the Boltzmann formula which simplifies to: \n            S = N * ln(N) - sumof(Ni ln Ni), N is the total particle count\n            ";
            "255";
            sum_ni_ln_ni = 0;
            "257";
            max_ni = 0;
            "259";
            var ρσ_Iter4 = bins.values();
            ρσ_Iter4 = ((typeof ρσ_Iter4[Symbol.iterator] === "function") ? (ρσ_Iter4 instanceof Map ? ρσ_Iter4.keys() : ρσ_Iter4) : Object.keys(ρσ_Iter4));
            for (var ρσ_Index4 of ρσ_Iter4) {
                ni = ρσ_Index4;
                "260";
                if (ni[">"](0)) {
                    "261";
                    sum_ni_ln_ni=sum_ni_ln_ni["+"](ni["*"](log(ni)));
                    "262";
                    if (ni[">"](max_ni)) {
                        "263";
                        max_ni = ni;
                    }
                }
            }
            "265";
            entropy = n["*"](log(n))["-"](1["*"](sum_ni_ln_ni));
            "266";
            entropy_label.text = "Boltzmann Entropy (S): "["+"](ρσ_str.format("{:.2f}", entropy))["+"]("");
            "269";
        }
        if (show_bins) {
            "270";
            bin_index = 0;
            "273";
            color_low = color.blue;
            "274";
            color_mid = color.red;
            "275";
            color_high = color.yellow;
            "277";
            var ρσ_Iter5 = bins.items();
            ρσ_Iter5 = ((typeof ρσ_Iter5[Symbol.iterator] === "function") ? (ρσ_Iter5 instanceof Map ? ρσ_Iter5.keys() : ρσ_Iter5) : Object.keys(ρσ_Iter5));
            for (var ρσ_Index5 of ρσ_Iter5) {
                ρσ_unpack = ρσ_Index5;
                key = ρσ_unpack[0];
                ni = ρσ_unpack[1];
                "278";
                if ((ni === 0 || typeof ni === "object" && ρσ_equals(ni, 0))) {
                    continue;
                }
                "281";
                if (bin_index[">="](len(bin_visuals))) {
                    "282";
                    new_bin_box = ρσ_interpolate_kwargs.call(this, box, [ρσ_desugar_kwargs({size: vector(1, 1, 1), visible: false, opacity: .3})]);
                    "283";
                    bin_visuals.append(new_bin_box);
                }
                "285";
                b = ρσ_getitem(bin_visuals, bin_index);
                "288";
                coords = key.split(",");
                "289";
                x = float(ρσ_getitem(coords, 0));
                "290";
                y = float(ρσ_getitem(coords, 1));
                "291";
                z = float(ρσ_getitem(coords, 2));
                "294";
                b.pos = vector(x["+"](.5), y["+"](.5), z["+"](.5));
                "297";
                fraction = 0;
                "298";
                if (max_ni[">"](0)) {
                    "299";
                    fraction = ni["/"](max_ni);
                    "301";
                }
                if (fraction["<"](.5)) {
                    "303";
                    b.color = (await mix_colors(color_low, color_mid, fraction["*"](2)));
                    "304";
                } else {
                    "306";
                    b.color = (await mix_colors(color_mid, color_high, fraction["-"](1["*"](.5))["*"](2)));
                }
                "308";
                b.visible = true;
                "309";
                bin_index=bin_index["+"](1);
            }
            "312";
            var ρσ_Iter6 = range(bin_index, len(bin_visuals));
            ρσ_Iter6 = ((typeof ρσ_Iter6[Symbol.iterator] === "function") ? (ρσ_Iter6 instanceof Map ? ρσ_Iter6.keys() : ρσ_Iter6) : Object.keys(ρσ_Iter6));
            for (var ρσ_Index6 of ρσ_Iter6) {
                i = ρσ_Index6;
                "313";
                ρσ_getitem(bin_visuals, i).visible = false;
                "315";
            }
        } else {
            "317";
            var ρσ_Iter7 = bin_visuals;
            ρσ_Iter7 = ((typeof ρσ_Iter7[Symbol.iterator] === "function") ? (ρσ_Iter7 instanceof Map ? ρσ_Iter7.keys() : ρσ_Iter7) : Object.keys(ρσ_Iter7));
            for (var ρσ_Index7 of ρσ_Iter7) {
                b = ρσ_Index7;
                "318";
                b.visible = false;
            }
        }
    }
};
if (!__main__.__module__) Object.defineProperties(__main__, {
    __module__ : {value: null}
});

;$(function(){ window.__context = { glowscript_container: $("#glowscript").removeAttr("id") }; __main__() })})()
// END JAVASCRIPT

//--><!]]></script>
</div>